name: "Elyseum Coverage Reporter"
description: "Installs elyseum-cli, runs it, and comments on a PR with the results"
inputs:
  node-version:
    description: "Node.js version to use"
    default: "22"
  result-file-path:
    description: "Path to the resulting file generated by elyseum-cli"
    default: "coverage/coverage-diff.md"
  command:
    description: "Command to run elyseum-cli with (diff-coverage, coverage, etc.)"
    default: "diff-coverage"
  comment-name:
    description: "Name of the comment to update or create"
    default: "Elyseum Coverage Reporter"
runs:
  using: "composite"
  steps:
    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: ${{ inputs.node-version }}

    - name: Install elyseum-cli
      shell: bash
      run: npm install -g @dragonshorn-studios/elyseum-cli

    - name: Run elyseum-cli
      shell: bash
      run: elyseum-cli ${{ inputs.command }} --base ${{ github.base_ref }} --head ${{ github.head_ref }} --reporter.coverage=github-pr-comment --reporter.coverage.github-pr-comment.comment-name ${{ inputs.comment-name }} --reporter.coverage.github-pr-comment.comment-file-path ${{ inputs.result-file-path }}

    - name: Update or create comment
      shell: bash
      run: node index.js
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        RESULT_FILE_PATH: ${{ inputs.result-file-path }}
        COMMENT_NAME: ${{ inputs.comment-name }}
